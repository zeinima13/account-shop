{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.number.parse-int.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/web.timers.js\";\nimport { getCurrentInstance, inject, ref } from 'vue';\nimport { isNull } from 'lodash-unified';\nimport { TABLE_INJECTION_KEY } from '../tokens.mjs';\nimport { isClient } from '@vueuse/core';\nimport { addClass, hasClass, removeClass } from '../../../../utils/dom/style.mjs';\nimport { isElement } from '../../../../utils/types.mjs';\nfunction useEvent(props, emit) {\n  var instance = getCurrentInstance();\n  var parent = inject(TABLE_INJECTION_KEY);\n  var handleFilterClick = function handleFilterClick(event) {\n    event.stopPropagation();\n    return;\n  };\n  var handleHeaderClick = function handleHeaderClick(event, column) {\n    if (!column.filters && column.sortable) {\n      handleSortClick(event, column, false);\n    } else if (column.filterable && !column.sortable) {\n      handleFilterClick(event);\n    }\n    parent == null ? void 0 : parent.emit(\"header-click\", column, event);\n  };\n  var handleHeaderContextMenu = function handleHeaderContextMenu(event, column) {\n    parent == null ? void 0 : parent.emit(\"header-contextmenu\", column, event);\n  };\n  var draggingColumn = ref(null);\n  var dragging = ref(false);\n  var dragState = ref({});\n  var handleMouseDown = function handleMouseDown(event, column) {\n    if (!isClient) return;\n    if (column.children && column.children.length > 0) return;\n    if (draggingColumn.value && props.border) {\n      dragging.value = true;\n      var table = parent;\n      emit(\"set-drag-visible\", true);\n      var tableEl = table == null ? void 0 : table.vnode.el;\n      var tableLeft = tableEl.getBoundingClientRect().left;\n      var columnEl = instance.vnode.el.querySelector(\"th.\".concat(column.id));\n      var columnRect = columnEl.getBoundingClientRect();\n      var minLeft = columnRect.left - tableLeft + 30;\n      addClass(columnEl, \"noclick\");\n      dragState.value = {\n        startMouseLeft: event.clientX,\n        startLeft: columnRect.right - tableLeft,\n        startColumnLeft: columnRect.left - tableLeft,\n        tableLeft: tableLeft\n      };\n      var resizeProxy = table == null ? void 0 : table.refs.resizeProxy;\n      resizeProxy.style.left = \"\".concat(dragState.value.startLeft, \"px\");\n      document.onselectstart = function () {\n        return false;\n      };\n      document.ondragstart = function () {\n        return false;\n      };\n      var handleMouseMove2 = function handleMouseMove2(event2) {\n        var deltaLeft = event2.clientX - dragState.value.startMouseLeft;\n        var proxyLeft = dragState.value.startLeft + deltaLeft;\n        resizeProxy.style.left = \"\".concat(Math.max(minLeft, proxyLeft), \"px\");\n      };\n      var _handleMouseUp = function handleMouseUp() {\n        if (dragging.value) {\n          var _dragState$value = dragState.value,\n            startColumnLeft = _dragState$value.startColumnLeft,\n            startLeft = _dragState$value.startLeft;\n          var finalLeft = Number.parseInt(resizeProxy.style.left, 10);\n          var columnWidth = finalLeft - startColumnLeft;\n          column.width = column.realWidth = columnWidth;\n          table == null ? void 0 : table.emit(\"header-dragend\", column.width, startLeft - startColumnLeft, column, event);\n          requestAnimationFrame(function () {\n            props.store.scheduleLayout(false, true);\n          });\n          document.body.style.cursor = \"\";\n          dragging.value = false;\n          draggingColumn.value = null;\n          dragState.value = {};\n          emit(\"set-drag-visible\", false);\n        }\n        document.removeEventListener(\"mousemove\", handleMouseMove2);\n        document.removeEventListener(\"mouseup\", _handleMouseUp);\n        document.onselectstart = null;\n        document.ondragstart = null;\n        setTimeout(function () {\n          removeClass(columnEl, \"noclick\");\n        }, 0);\n      };\n      document.addEventListener(\"mousemove\", handleMouseMove2);\n      document.addEventListener(\"mouseup\", _handleMouseUp);\n    }\n  };\n  var handleMouseMove = function handleMouseMove(event, column) {\n    var _a;\n    if (column.children && column.children.length > 0) return;\n    var el = event.target;\n    if (!isElement(el)) {\n      return;\n    }\n    var target = el == null ? void 0 : el.closest(\"th\");\n    if (!column || !column.resizable || !target) return;\n    if (!dragging.value && props.border) {\n      var rect = target.getBoundingClientRect();\n      var bodyStyle = document.body.style;\n      var isLastTh = ((_a = target.parentNode) == null ? void 0 : _a.lastElementChild) === target;\n      var allowDarg = props.allowDragLastColumn || !isLastTh;\n      if (rect.width > 12 && rect.right - event.pageX < 8 && allowDarg) {\n        bodyStyle.cursor = \"col-resize\";\n        if (hasClass(target, \"is-sortable\")) {\n          target.style.cursor = \"col-resize\";\n        }\n        draggingColumn.value = column;\n      } else if (!dragging.value) {\n        bodyStyle.cursor = \"\";\n        if (hasClass(target, \"is-sortable\")) {\n          target.style.cursor = \"pointer\";\n        }\n        draggingColumn.value = null;\n      }\n    }\n  };\n  var handleMouseOut = function handleMouseOut() {\n    if (!isClient) return;\n    document.body.style.cursor = \"\";\n  };\n  var toggleOrder = function toggleOrder(_ref) {\n    var order = _ref.order,\n      sortOrders = _ref.sortOrders;\n    if (order === \"\") return sortOrders[0];\n    var index = sortOrders.indexOf(order || null);\n    return sortOrders[index > sortOrders.length - 2 ? 0 : index + 1];\n  };\n  var handleSortClick = function handleSortClick(event, column, givenOrder) {\n    var _a;\n    event.stopPropagation();\n    var order = column.order === givenOrder ? null : givenOrder || toggleOrder(column);\n    var target = (_a = event.target) == null ? void 0 : _a.closest(\"th\");\n    if (target) {\n      if (hasClass(target, \"noclick\")) {\n        removeClass(target, \"noclick\");\n        return;\n      }\n    }\n    if (!column.sortable) return;\n    var clickTarget = event.currentTarget;\n    if ([\"ascending\", \"descending\"].some(function (str) {\n      return hasClass(clickTarget, str) && !column.sortOrders.includes(str);\n    })) {\n      return;\n    }\n    var states = props.store.states;\n    var sortProp = states.sortProp.value;\n    var sortOrder;\n    var sortingColumn = states.sortingColumn.value;\n    if (sortingColumn !== column || sortingColumn === column && isNull(sortingColumn.order)) {\n      if (sortingColumn) {\n        sortingColumn.order = null;\n      }\n      states.sortingColumn.value = column;\n      sortProp = column.property;\n    }\n    if (!order) {\n      sortOrder = column.order = null;\n    } else {\n      sortOrder = column.order = order;\n    }\n    states.sortProp.value = sortProp;\n    states.sortOrder.value = sortOrder;\n    parent == null ? void 0 : parent.store.commit(\"changeSortCondition\");\n  };\n  return {\n    handleHeaderClick: handleHeaderClick,\n    handleHeaderContextMenu: handleHeaderContextMenu,\n    handleMouseDown: handleMouseDown,\n    handleMouseMove: handleMouseMove,\n    handleMouseOut: handleMouseOut,\n    handleSortClick: handleSortClick,\n    handleFilterClick: handleFilterClick\n  };\n}\nexport { useEvent as default };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}