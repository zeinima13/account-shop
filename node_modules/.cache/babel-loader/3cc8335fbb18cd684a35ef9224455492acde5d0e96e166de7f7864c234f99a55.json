{"ast":null,"code":"import _toConsumableArray from \"C:/Users/ASUS/CascadeProjects/account-shop/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _defineProperty from \"C:/Users/ASUS/CascadeProjects/account-shop/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"C:/Users/ASUS/CascadeProjects/account-shop/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport { defineComponent, inject, ref, computed, markRaw, watch, openBlock, createElementBlock, unref, normalizeClass, normalizeStyle, Fragment, renderList, createVNode, withCtx, withDirectives, createBlock, resolveDynamicComponent, vShow, createCommentVNode, toDisplayString } from 'vue';\nimport { ElIcon } from '../../icon/index.mjs';\nimport { rateProps, rateEmits } from './rate.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { formContextKey, formItemContextKey } from '../../form/src/constants.mjs';\nimport { useFormSize } from '../../form/src/hooks/use-form-common-props.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { useFormItemInputId } from '../../form/src/hooks/use-form-item.mjs';\nimport { isArray, isObject, isString } from '@vue/shared';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { hasClass } from '../../../utils/dom/style.mjs';\nvar __default__ = defineComponent({\n  name: \"ElRate\"\n});\nvar _sfc_main = /* @__PURE__ */defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: rateProps,\n  emits: rateEmits,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose,\n      emit = _ref.emit;\n    var props = __props;\n    function getValueFromMap(value, map) {\n      var isExcludedObject = function isExcludedObject(val) {\n        return isObject(val);\n      };\n      var matchedKeys = Object.keys(map).map(function (key) {\n        return +key;\n      }).filter(function (key) {\n        var val = map[key];\n        var excluded = isExcludedObject(val) ? val.excluded : false;\n        return excluded ? value < key : value <= key;\n      }).sort(function (a, b) {\n        return a - b;\n      });\n      var matchedValue = map[matchedKeys[0]];\n      return isExcludedObject(matchedValue) && matchedValue.value || matchedValue;\n    }\n    var formContext = inject(formContextKey, void 0);\n    var formItemContext = inject(formItemContextKey, void 0);\n    var rateSize = useFormSize();\n    var ns = useNamespace(\"rate\");\n    var _useFormItemInputId = useFormItemInputId(props, {\n        formItemContext: formItemContext\n      }),\n      inputId = _useFormItemInputId.inputId,\n      isLabeledByFormItem = _useFormItemInputId.isLabeledByFormItem;\n    var currentValue = ref(props.modelValue);\n    var hoverIndex = ref(-1);\n    var pointerAtLeftHalf = ref(true);\n    var rateClasses = computed(function () {\n      return [ns.b(), ns.m(rateSize.value)];\n    });\n    var rateDisabled = computed(function () {\n      return props.disabled || (formContext == null ? void 0 : formContext.disabled);\n    });\n    var rateStyles = computed(function () {\n      return ns.cssVarBlock({\n        \"void-color\": props.voidColor,\n        \"disabled-void-color\": props.disabledVoidColor,\n        \"fill-color\": activeColor.value\n      });\n    });\n    var text = computed(function () {\n      var result = \"\";\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(/\\{\\s*value\\s*\\}/, rateDisabled.value ? \"\".concat(props.modelValue) : \"\".concat(currentValue.value));\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1];\n      }\n      return result;\n    });\n    var valueDecimal = computed(function () {\n      return props.modelValue * 100 - Math.floor(props.modelValue) * 100;\n    });\n    var colorMap = computed(function () {\n      return isArray(props.colors) ? _defineProperty(_defineProperty(_defineProperty({}, props.lowThreshold, props.colors[0]), props.highThreshold, {\n        value: props.colors[1],\n        excluded: true\n      }), props.max, props.colors[2]) : props.colors;\n    });\n    var activeColor = computed(function () {\n      var color = getValueFromMap(currentValue.value, colorMap.value);\n      return isObject(color) ? \"\" : color;\n    });\n    var decimalStyle = computed(function () {\n      var width = \"\";\n      if (rateDisabled.value) {\n        width = \"\".concat(valueDecimal.value, \"%\");\n      } else if (props.allowHalf) {\n        width = \"50%\";\n      }\n      return {\n        color: activeColor.value,\n        width: width\n      };\n    });\n    var componentMap = computed(function () {\n      var icons = isArray(props.icons) ? _toConsumableArray(props.icons) : _objectSpread({}, props.icons);\n      icons = markRaw(icons);\n      return isArray(icons) ? _defineProperty(_defineProperty(_defineProperty({}, props.lowThreshold, icons[0]), props.highThreshold, {\n        value: icons[1],\n        excluded: true\n      }), props.max, icons[2]) : icons;\n    });\n    var decimalIconComponent = computed(function () {\n      return getValueFromMap(props.modelValue, componentMap.value);\n    });\n    var voidComponent = computed(function () {\n      return rateDisabled.value ? isString(props.disabledVoidIcon) ? props.disabledVoidIcon : markRaw(props.disabledVoidIcon) : isString(props.voidIcon) ? props.voidIcon : markRaw(props.voidIcon);\n    });\n    var activeComponent = computed(function () {\n      return getValueFromMap(currentValue.value, componentMap.value);\n    });\n    function showDecimalIcon(item) {\n      var showWhenDisabled = rateDisabled.value && valueDecimal.value > 0 && item - 1 < props.modelValue && item > props.modelValue;\n      var showWhenAllowHalf = props.allowHalf && pointerAtLeftHalf.value && item - 0.5 <= currentValue.value && item > currentValue.value;\n      return showWhenDisabled || showWhenAllowHalf;\n    }\n    function emitValue(value) {\n      if (props.clearable && value === props.modelValue) {\n        value = 0;\n      }\n      emit(UPDATE_MODEL_EVENT, value);\n      if (props.modelValue !== value) {\n        emit(\"change\", value);\n      }\n    }\n    function selectValue(value) {\n      if (rateDisabled.value) {\n        return;\n      }\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emitValue(currentValue.value);\n      } else {\n        emitValue(value);\n      }\n    }\n    function handleKey(e) {\n      if (rateDisabled.value) {\n        return;\n      }\n      var _currentValue = currentValue.value;\n      var code = e.code;\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5;\n        } else {\n          _currentValue += 1;\n        }\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5;\n        } else {\n          _currentValue -= 1;\n        }\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      _currentValue = _currentValue < 0 ? 0 : _currentValue;\n      _currentValue = _currentValue > props.max ? props.max : _currentValue;\n      emit(UPDATE_MODEL_EVENT, _currentValue);\n      emit(\"change\", _currentValue);\n      return _currentValue;\n    }\n    function setCurrentValue(value, event) {\n      if (rateDisabled.value) {\n        return;\n      }\n      if (props.allowHalf && event) {\n        var target = event.target;\n        if (hasClass(target, ns.e(\"item\"))) {\n          target = target.querySelector(\".\".concat(ns.e(\"icon\")));\n        }\n        if (target.clientWidth === 0 || hasClass(target, ns.e(\"decimal\"))) {\n          target = target.parentNode;\n        }\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth;\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value;\n      } else {\n        currentValue.value = value;\n      }\n      hoverIndex.value = value;\n    }\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return;\n      }\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n      }\n      currentValue.value = props.modelValue;\n      hoverIndex.value = -1;\n    }\n    watch(function () {\n      return props.modelValue;\n    }, function (val) {\n      currentValue.value = val;\n      pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n    });\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0);\n    }\n    expose({\n      setCurrentValue: setCurrentValue,\n      resetCurrentValue: resetCurrentValue\n    });\n    return function (_ctx, _cache) {\n      var _a;\n      return openBlock(), createElementBlock(\"div\", {\n        id: unref(inputId),\n        \"class\": normalizeClass([unref(rateClasses), unref(ns).is(\"disabled\", unref(rateDisabled))]),\n        role: \"slider\",\n        \"aria-label\": !unref(isLabeledByFormItem) ? _ctx.ariaLabel || \"rating\" : void 0,\n        \"aria-labelledby\": unref(isLabeledByFormItem) ? (_a = unref(formItemContext)) == null ? void 0 : _a.labelId : void 0,\n        \"aria-valuenow\": currentValue.value,\n        \"aria-valuetext\": unref(text) || void 0,\n        \"aria-valuemin\": \"0\",\n        \"aria-valuemax\": _ctx.max,\n        tabindex: \"0\",\n        style: normalizeStyle(unref(rateStyles)),\n        onKeydown: handleKey\n      }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.max, function (item, key) {\n        return openBlock(), createElementBlock(\"span\", {\n          key: key,\n          \"class\": normalizeClass(unref(ns).e(\"item\")),\n          onMousemove: function onMousemove($event) {\n            return setCurrentValue(item, $event);\n          },\n          onMouseleave: resetCurrentValue,\n          onClick: function onClick($event) {\n            return selectValue(item);\n          }\n        }, [createVNode(unref(ElIcon), {\n          \"class\": normalizeClass([unref(ns).e(\"icon\"), {\n            hover: hoverIndex.value === item\n          }, unref(ns).is(\"active\", item <= currentValue.value)])\n        }, {\n          \"default\": withCtx(function () {\n            return [!showDecimalIcon(item) ? (openBlock(), createElementBlock(Fragment, {\n              key: 0\n            }, [withDirectives((openBlock(), createBlock(resolveDynamicComponent(unref(activeComponent)), null, null, 512)), [[vShow, item <= currentValue.value]]), withDirectives((openBlock(), createBlock(resolveDynamicComponent(unref(voidComponent)), null, null, 512)), [[vShow, !(item <= currentValue.value)]])], 64)) : createCommentVNode(\"v-if\", true), showDecimalIcon(item) ? (openBlock(), createElementBlock(Fragment, {\n              key: 1\n            }, [(openBlock(), createBlock(resolveDynamicComponent(unref(voidComponent)), {\n              \"class\": normalizeClass([unref(ns).em(\"decimal\", \"box\")])\n            }, null, 8, [\"class\"])), createVNode(unref(ElIcon), {\n              style: normalizeStyle(unref(decimalStyle)),\n              \"class\": normalizeClass([unref(ns).e(\"icon\"), unref(ns).e(\"decimal\")])\n            }, {\n              \"default\": withCtx(function () {\n                return [(openBlock(), createBlock(resolveDynamicComponent(unref(decimalIconComponent))))];\n              }),\n              _: 1\n            }, 8, [\"style\", \"class\"])], 64)) : createCommentVNode(\"v-if\", true)];\n          }),\n          _: 2\n        }, 1032, [\"class\"])], 42, [\"onMousemove\", \"onClick\"]);\n      }), 128)), _ctx.showText || _ctx.showScore ? (openBlock(), createElementBlock(\"span\", {\n        key: 0,\n        \"class\": normalizeClass(unref(ns).e(\"text\")),\n        style: normalizeStyle({\n          color: _ctx.textColor\n        })\n      }, toDisplayString(unref(text)), 7)) : createCommentVNode(\"v-if\", true)], 46, [\"id\", \"aria-label\", \"aria-labelledby\", \"aria-valuenow\", \"aria-valuetext\", \"aria-valuemax\"]);\n    };\n  }\n}));\nvar Rate = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"rate.vue\"]]);\nexport { Rate as default };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}